<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:body>

	<ui:composition template="/templates/template.xhtml">

		<ui:define name="content">

			<!-- Mensagem de Erro -->
			<p:growl id="growl" showDetail="true" autoUpdate="true"
				redisplay="false" life="5000" severity="info,warn,error" />

			<h:form id="form">

				<h:panelGroup styleClass="ficha">

					<h:panelGroup styleClass="inline" style="-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;width: 100%;">
					
						<h:panelGroup styleClass="column" style="width:100%">
							<h:outputText value="Manifestações" styleClass="tituloBox" style="align-self:flex-start; margin:0; margin-left:5vw;" />
							<p:separator styleClass="separator2" style="align-self:flex-start;margin-left:5vw;"/>
						</h:panelGroup>
			
						<h:commandLink id="showBtn" styleClass="legendaButton" disabled="true" style="position: absolute; right: 10px;">
					    	<i class="fa fa-question fa-2x" />
					    </h:commandLink>
					    
					    <p:tooltip id="toolTipContent" for="showBtn" position="left" styleClass="legendaTooltip" style="width: 600px; margin-right: 50px">
					    	<p style="font-weight: bold; text-align: center">Status da solicitação</p>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #2196f3; margin-right: .5em; color:white !important">Aberta</span>Manifestação protocolada ainda pendente de leitura pelo órgão/entidade demandado</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #489106; margin-right: .5em; color:white !important">Atendida</span>Manifestação atendida pelo órgão/entidade demandado aguardando manifestação do requerente no prazo de 10 dias</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #858f9c; margin-right: .5em; color:white !important">Finalizada</span>Manifestação atendida pelo órgão/entidade demandado, cujo prazo para recurso foi expirado sem manifestação do requerente</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #5bc0de; margin-right: .5em; color:white !important">Reencaminhada</span>Manifestação redirecionada a outro órgão/entidade por ausência de competência do demandado</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #d30e03; margin-right: .5em; color:white !important">Negada</span>Manifestação com justificativa legal para não atendimento</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #824fbf; margin-right: .5em; color:white !important">Prorrogada</span>Manifestação houve pedido de prorrogação do prazo de 10 dias encaminhado ao requerente</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #eab90f; margin-right: .5em; color:white !important">Recurso</span>Manifestação aguardando atendimento de recurso apresentado pelo requerente</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #e77b40; margin-right: .5em; color:white !important">Sem Resposta</span>Manifestação finalizada automaticamente pelo sistema quando houver ausência de resposta ou prorrogação no prazo legal</p>
							</h:panelGroup>
							<h:panelGroup styleClass="inline" style="align-items: flex-start; text-align: justify">
								<p> <span class="statusBox" style="background: #0039ff; margin-right: .5em; color:white !important">Transição</span>Pedido de informação migrado do sistema antigo ainda aberto para atendimento.</p>
							</h:panelGroup>
					    </p:tooltip>
				    
				    </h:panelGroup>

					<h:panelGroup id="solicitacao_panel" rendered="#{usuario.usuario.perfil ne '0' and usuario.usuario.perfil ne '1'}" style="display: block; max-width: 100% !important">
						<p:dataTable id="solicitacoes" widgetVar="slt" var="slt"
							emptyMessage="Nao há solicitação" sortBy="#{slt.status}"
							expandableRowGroups="false" resizableColumns="true"
							liveResize="true" value="#{solicitacao.filteredSolicitacoes}"
							rowStyleClass="#{slt.status}" style="margin-bottom:1vw;"
							filteredValue="#{solicitacao.solicitacoesFiltradas}"
							paginator="true" rows="50" reflow="true" styleClass="ui-datatable-hor-scroll"
							currentPageReportTemplate="(Página {currentPage} de {totalPages})"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							rowsPerPageTemplate="10,25,50,100" rowKey="#{slt.idSolicitacao}">
							<f:facet name="header">
								<p:commandLink id="toggler" style="float:left"
									styleClass="togglerBtn">
									<i class="fa fa-columns" />
									<h:outputText value="Colunas" />
								</p:commandLink>
								<p:columnToggler datasource="solicitacoes" trigger="toggler" >
									<p:ajax event="toggle" listener="#{solicitacao.onToggle}" />
								</p:columnToggler>

								<p:outputPanel styleClass="searchPanel">
									<i class="fa fa-search"
										style="color: white; margin-right: .5em" />
									<p:inputText id="globalFilter" onkeyup="PF('slt').filter()"
										style="width:50%" placeholder="Insira campo a ser pesquisado" />
								</p:outputPanel>
							</f:facet>

							<f:facet name="filter">
								<p:calendar pattern="dd/MM/yyyy">
									<p:ajax event="dateSelect" oncomplete="PF('slt').filter()" />
								</p:calendar>
							</f:facet>

							<p:column ariaHeaderText="Icones" width="20" toggleable="false"	style="text-align:center;" visible="#{solicitacao.list[0]}">
								<h:panelGroup id="iconDenuncia"
									rendered="#{slt.tipo eq 'Denúncia'}">
									<i class="fa fa-exclamation-circle" />
								</h:panelGroup>
								<p:tooltip for="iconDenuncia" value="Denúncia" position="right" />
								<h:panelGroup id="iconInfo"
									rendered="#{slt.tipo eq 'Informação'}">
									<i class="fa fa-info" />
								</h:panelGroup>
								<p:tooltip for="iconInfo" value="Pedido de Informação"
									position="right" />
								<h:panelGroup id="iconSol"
									rendered="#{slt.tipo eq 'Solicitação'}">
									<i class="fa fa-hand-o-up" />
								</h:panelGroup>
								<p:tooltip for="iconSol" value="Solicitação" position="right" />
								<h:panelGroup id="iconElogio" rendered="#{slt.tipo eq 'Elogio'}">
									<i class="fa fa-thumbs-o-up" />
								</h:panelGroup>
								<p:tooltip for="iconElogio" value="Elogio" position="right" />
								<h:panelGroup id="iconSugestao"
									rendered="#{slt.tipo eq 'Sugestão'}">
									<i class="fa fa-comments" />
								</h:panelGroup>
								<p:tooltip for="iconSugestao" value="Sugestão" position="right" />
								<h:panelGroup id="iconReclama"
									rendered="#{slt.tipo eq 'Reclamação'}">
									<i class="fa fa-thumbs-o-down" />
								</h:panelGroup>
								<p:tooltip for="iconReclama" value="Reclamação" position="right" />
							</p:column>

							<p:column headerText="Protocolo" width="150" sortBy="#{slt.protocolo}" visible="#{solicitacao.list[1]}"
								filterBy="#{slt.protocolo}" filterable="false">
								<h:outputText value="#{slt.protocolo}" />
							</p:column>

							<p:column headerText="Tipo" width="85" sortBy="#{slt.tipo}" visible="#{solicitacao.list[2]}"
								filterBy="#{slt.tipo}" filterMatchMode="contains"
								filterable="false">
								<h:outputText value="#{slt.tipo}" />
							</p:column>
							
							<p:column headerText="Órgão" width="80"
								sortBy="#{slt.entidades.sigla}" visible="#{solicitacao.list[3]}"
								filterBy="#{slt.entidades.sigla}" filterMatchMode="contains"
								filterable="false">
								<h:outputText value="#{slt.entidades.sigla}" />
							</p:column>

							<p:column headerText="Assunto" width="120" sortBy="#{slt.tipo}" visible="#{solicitacao.list[4]}"
								filterBy="#{slt.competencias.acoes.titulo}" filterMatchMode="contains"
								filterable="false">
								<h:outputText value="#{slt.competencias.acoes.titulo}" />
							</p:column>
							
							<p:column headerText="Título" sortBy="#{slt.titulo}" width="150" visible="#{solicitacao.list[5]}"
								filterBy="#{slt.titulo}" filterMatchMode="contains"	filterable="false">
								<h:outputText value="#{slt.titulo}" />
							</p:column>

							<p:column headerText="Data inicial" sortBy="#{slt.dataIni}"
								width="100" style="text-align:center" visible="#{solicitacao.list[6]}"
								filterBy="#{slt.dataIni}" filterMatchMode="exact"
								filterable="false">
								<h:outputText value="#{slt.dataIni}">
									<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-03:00" />
								</h:outputText>
							</p:column>
							
							<p:column headerText="Data limite" sortBy="#{slt.dataLimite}"
								width="100" style="text-align:center" visible="#{solicitacao.list[7]}"
								filterBy="#{slt.dataLimite}" filterMatchMode="exact"
								filterable="false">
								<h:outputText value="#{slt.dataLimite}"
									rendered="#{slt.tipo eq 'Informação' or slt.tipo eq 'Solicitação' or slt.tipo eq 'Denúncia'}">
									<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-03:00" />
								</h:outputText>
								<h:outputText value=" ----------- " style="color: #c0c0c0;"
									rendered="#{slt.tipo eq 'Sugestão' or slt.tipo eq 'Elogio' or slt.tipo eq 'Reclamação'}" />
							</p:column>
<!-- 							styleClass="prazo #{(slt.status eq 'Finalizada' or slt.tipo ne 'Informação' or slt.tipo ne 'Solicitação') ? 'branco' : (slt.prazoTipo eq 3 ? 'verde' : (slt.prazoTipo eq 2 ? 'amarelo' : (slt.prazoTipo eq 1 ? 'vermelho' : 'branco')))}" -->

							<p:column headerText="Data final" sortBy="#{slt.datafim}" visible="#{solicitacao.list[8]}"
								width="100" style="text-align:center" filterBy="#{slt.datafim}"
								filterMatchMode="exact" filterable="false">
								<h:outputText value=" ----------- "
									rendered="#{slt.datafim eq null}" style="color: #c0c0c0;" />
								<h:outputText value="#{slt.datafim}"
									rendered="#{slt.datafim ne null}">
									<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-03:00" />
								</h:outputText>
							</p:column>

							<p:column headerText="Cidadão" width="150" visible="#{solicitacao.list[9]}"
								sortBy="#{slt.cidadao.usuario.nome}" filterBy="#{slt.cidadao.usuario.nome}"
								filterMatchMode="contains" filterable="false" rendered="#{usuario.usuario.perfil ne '3' }">
<!-- 								<h:outputText value="#{slt.sigilo eq false ? slt.cidadao.usuario.nome : 'Sigilo'}" /> -->
								<h:outputText value="#{slt.cidadao.usuario.nome}"/>
							</p:column>
							
							<p:column headerText="Status" visible="#{solicitacao.list[10]}" width="120" sortBy="#{slt.status}" filterBy="#{slt.status}" filterMatchMode="exact" filterable="false" groupRow="false" style="text-align: center">
<!-- 								<h:outputText id="statusLabel" value="#{slt.status}" styleClass="statusBox" rendered="#{slt.status ne 'Atendida' and slt.status ne 'Transição'}"/> -->
								<h:outputText id="statusAberta" value="Aberta" styleClass="statusBox aberta" rendered="#{slt.status eq 'Aberta'}"/>
								<h:outputText id="statusAtendida" value="Atendida" styleClass="statusBox atendida" rendered="#{slt.status eq 'Atendida'}"/>
								<h:outputText id="statusFinal" value="Finalizada" styleClass="statusBox finalizada" rendered="#{slt.status eq 'Finalizada'}"/>
								<h:outputText id="statusReenc" value="Reencaminhada" styleClass="statusBox reencaminhada" rendered="#{slt.status eq 'Reencaminhada'}"/>
								<h:outputText id="statusNegada" value="Negada" styleClass="statusBox negada" rendered="#{slt.status eq 'Negada'}"/>
								<h:outputText id="statusProrro" value="Prorrogada" styleClass="statusBox prorrogada" rendered="#{slt.status eq 'Prorrogada'}"/>
								<h:outputText id="statusRecurso" value="Recurso" styleClass="statusBox recurso" rendered="#{slt.status eq 'Recurso'}"/>
								<h:outputText id="statusSemResp" value="Sem Resposta" styleClass="statusBox semResposta" rendered="#{slt.status eq 'Sem Resposta'}"/>
								<h:outputText id="statusTransicao" value="Transição" styleClass="statusBox transicao" rendered="#{slt.status eq 'Transição'}"/>
								
								<!-- TOOL-TIPS -->
								<p:tooltip for="statusAberta" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Aberta'}">
									<p>Manifestação protocolada ainda pendente de leitura pelo órgão/entidade demandado</p>
								</p:tooltip>
								<p:tooltip for="statusAtendida" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Atendida'}">
									<p>Manifestação atendida pelo órgão/entidade demandado aguardando manifestação do requerente no prazo de 10 dias</p>
								</p:tooltip>
								<p:tooltip for="statusFinal" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Finalizada'}">
									<p>Manifestação atendida pelo órgão/entidade demandado, cujo prazo para recurso foi expirado sem manifestação do requerente</p>
								</p:tooltip>
								<p:tooltip for="statusReenc" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Reencaminhada'}">
									<p>Manifestação redirecionada a outro órgão/entidade por ausência de competência do demandado</p>
								</p:tooltip>
								<p:tooltip for="statusNegada" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Negada'}">
									<p>Manifestação com justificativa legal para não atendimento</p>
								</p:tooltip>
								<p:tooltip for="statusProrro" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Prorrogada'}">
									<p>Manifestação houve pedido de prorrogação do prazo de 10 dias encaminhado ao requerente</p>
								</p:tooltip>
								<p:tooltip for="statusRecurso" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Recurso'}">
									<p>Manifestação aguardando atendimento de recurso apresentado pelo requerente</p>
								</p:tooltip>
								<p:tooltip for="statusSemResp" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Sem Resposta'}">
									<p>Manifestação finalizada automaticamente pelo sistema quando houver ausência de resposta ou prorrogação no prazo legal</p>
								</p:tooltip>
								<p:tooltip for="statusTransicao" position="bottom" style="width: 700px" rendered="#{slt.status eq 'Transição'}">
									<p>Pedido de informação migrado do sistema antigo ainda aberto para atendimento.</p>
								</p:tooltip>
								
							</p:column>

							<p:column visible="#{solicitacao.list[11]}" style="width:32px; text-align: center" toggleable="false">
								<p:commandLink class="botaoLinkIcon" update="solicitacaoDetalhe" actionListener="#{solicitacao.visualizouSolicitacao(slt)}"
									onclick="PF('detalheDialog').show(); PF('detalheDialog').toggleMaximize();">
									<p:ajax listener="#{solicitacao.popularMensagens}" />
									<i class="fa fa-search" />
									<f:setPropertyActionListener value="#{slt}"	target="#{solicitacao.solicitacao}" />
									<f:setPropertyActionListener value="#{slt}"	target="#{mensagem.solicitacao}" />
								</p:commandLink>
							</p:column>

						</p:dataTable>

					</h:panelGroup>

				</h:panelGroup>

			</h:form>


			<!-- Dialog Detalhe Solicitação -->
			<p:dialog widgetVar="detalheDialog" id="detalheDialog" modal="true" fitViewport="true"
				showEffect="fade" hideEffect="fade" resizable="false"
				maximizable="false" draggable="false" closeOnEscape="true"
				onHide="PF('detalheDialog').toggleMaximize(); #{solicitacao.finalizarSolicitacao()}"
				styleClass="solicitacaoDialog" >
				
				<p:outputPanel id="solicitacaoDetalhe"
					style="display:flex; flex-flow: row; overflow-x: hidden;">
					<h:panelGroup id="conteudo" style="padding: 10px">
						<h:panelGroup styleClass="inline" style="width: 100%">
						<p:panelGrid columns="2" layout="grid" style="border: none; width: 50%;">

							<h:outputText value="Protocolo:" style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.protocolo}" />
							
							<h:outputText value="Solicitante:"	style="color:#1a568c; font-size:18px" />
							<h:panelGroup styleClass="inline">
								<h:outputText value="#{solicitacao.solicitacao.cidadao.usuario.nome}"/>
								<h:outputText value="(Sigilo)" rendered="#{solicitacao.solicitacao.sigilo eq true}" style="margin-left:.5em; font-weight:bold; color:#c02222"/>
							</h:panelGroup>
							
							
							<h:outputText value="Título:" style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.titulo}" />
							
							<h:outputText value="Tema:" style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.competencias.acoes.titulo}" />

							<h:outputText value="Assunto:" style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.competencias.descricao}" />

							<h:outputText value="Órgão / Entidade:"	style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.entidades.sigla} - #{solicitacao.solicitacao.entidades.nome}" />
							
							<h:outputText value="Forma de Recebimento da resposta:"	style="color:#1a568c; font-size:18px" rendered="#{solicitacao.formaRecebimentoString ne '...'}" />
							<h:outputText value="#{solicitacao.formaRecebimentoString}" rendered="#{solicitacao.formaRecebimentoString ne '...'}" />

						</p:panelGrid>
						
						<p:panelGrid columns="2" layout="grid"	style="border: none; width: 50%;">

							<h:outputText value="Tipo de solicitacao:"
								style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.tipo}" rendered="#{!(solicitacao.solicitacao.tipo eq 'Denúncia' and solicitacao.solicitacao.sigilo eq true)}"/>
							<h:outputText value="Denúncia Sigilosa" rendered="#{solicitacao.solicitacao.tipo eq 'Denúncia' and solicitacao.solicitacao.sigilo eq true}" />
							

							<h:outputText value="Status:" style="color:#1a568c; font-size:18px"	rendered="#{solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação'}" />
							<h:outputText value="#{solicitacao.solicitacao.status}"	rendered="#{solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação'}" />

							<h:outputText value="Instancia:" style="color:#1a568c; font-size:18px" rendered="#{solicitacao.solicitacao.tipo ne 'Denúncia' and solicitacao.solicitacao.instancia ne '0'}" />
							<h:outputText value="#{solicitacao.solicitacao.instancia}ª instância" rendered="#{solicitacao.solicitacao.tipo ne 'Denúncia' and solicitacao.solicitacao.instancia ne '0'}" />

							<h:outputText value="Data Inicial:"	style="color:#1a568c; font-size:18px" />
							<h:outputText value="#{solicitacao.solicitacao.dataIni}">
								<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-03:00" />
							</h:outputText>

							<h:outputText value="Data Limite:" style="color:#1a568c; font-size:18px" rendered="#{(solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Denúncia') and solicitacao.solicitacao.status ne 'Finalizada'}" />
							<h:outputText value="#{solicitacao.solicitacao.dataLimite}"	rendered="#{(solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Denúncia') and solicitacao.solicitacao.status ne 'Finalizada'}">
								<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-03:00" />
							</h:outputText>
							
							<h:outputText value="Data Fim:" style="color:#1a568c; font-size:18px" rendered="#{(solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Denúncia') and solicitacao.solicitacao.datafim ne null}" />
							<h:outputText value="#{solicitacao.solicitacao.datafim}" rendered="#{(solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Denúncia') and solicitacao.solicitacao.datafim ne null}">
								<f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT-03:00" />
							</h:outputText>
							
							<h:outputText value="Nota:" style="color:#1a568c; font-size:18px" rendered="#{solicitacao.solicitacao.avaliacao ne '0'}"/>
							<h:outputText value="#{solicitacao.solicitacao.avaliacao}" rendered="#{solicitacao.solicitacao.avaliacao ne '0'}"/>

						</p:panelGrid>
						</h:panelGroup>

						<!-- Caixa de mensagens -->

						<p:tabView dynamic="true" cache="true">
							<p:tab title="Mensagens">
							
								<p:dataList value="#{mensagem.mensagensSolicitacao}" var="msg" type="definition" styleClass="consultaDatalist" rendered="false">
									<p:outputPanel style="margin-top: 1vw;">
										<div class="mensagem">
											<h:outputText value="#{msg.usuario.nome}"
												style="color:#1a568c" />
											<h:outputText value="#{msg.data}" style="color:#1a568c">
												<f:convertDateTime pattern="d/M/yy - hh:mm"
													timeZone="GMT-03:00" />
											</h:outputText>
										</div>
										
										<h:outputText value="#{msg.texto}" style="margin-left:1vw; white-space: pre-wrap;" />
										
											
									</p:outputPanel>
								</p:dataList>

								<p:dataScroller value="#{mensagem.mensagensSolicitacao}" rendered="true"
									var="msg" chunkSize="2" rows="2" style="margin-bottom:1vw;">

									<f:facet name="loader">
										<p:commandLink id="outrasMsgs">
											<h:outputText value="Mais Mensagens" />
											<br />
											<i class="fa fa-caret-down" />
										</p:commandLink>
										<p:tooltip id="toolTipOutrasMsgs"
											value="Visualizar mensagens seguintes" for="outrasMsgs"
											position="top" style="box-shadow:none" />
									</f:facet>

									<p:outputPanel style="margin-top: 1vw;">
										<div class="mensagem">
											<h:outputText value="#{msg.usuario.nome}" style="color:#1a568c" />
											<h:outputText value="#{msg.data}" style="color:#1a568c">
												<f:convertDateTime pattern="d/M/yy - hh:mm"	timeZone="GMT-03:00" />
											</h:outputText>
										</div>
										
										<h:outputText value="#{msg.texto}" style="margin-left:1vw; white-space: pre-wrap;" />
										
										<h:form>
											<p:commandButton value="Download" ajax="false" icon="ui-icon-arrowthick-1-s" rendered="#{attachment.temAnexo(msg.idMensagem)}">
										        <p:fileDownload value="#{attachment.download(msg.idMensagem)}" />
										    </p:commandButton>
									    </h:form>
											
									</p:outputPanel>

								</p:dataScroller>
							</p:tab>
							<p:tab title="Histórico da Solicitação"
								rendered="#{solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Denúncia'}">
								<p:dataScroller value="#{mensagem.mensagensHistorico}" var="msg"
									chunkSize="2" rows="2" style="margin-bottom:1vw;">

									<f:facet name="loader">
										<p:commandLink id="outrasMsgs">
											<h:outputText value="Outras Mensagens" />
											<br />
											<i class="fa fa-caret-down" />
										</p:commandLink>
										<p:tooltip id="toolTipOutrasMsgs"
											value="Visualizar mensagens anteriores" for="outrasMsgs"
											position="top" style="box-shadow:none" />
									</f:facet>

									<p:outputPanel style="margin-top: 1vw;">
										<div class="mensagem">
											<h:outputText value="#{msg.usuario.nome}"
												style="color:#1a568c" />
											<h:outputText value="#{msg.data}" style="color:#1a568c">
												<f:convertDateTime pattern="d/M/yy - hh:mm"
													timeZone="GMT-03:00" />
											</h:outputText>
										</div>
										<h:outputText value="#{msg.texto}" style="margin-left:1vw" />

									</p:outputPanel>

								</p:dataScroller>

							</p:tab>
							<p:tab title="Trâmite Interno"
								rendered="#{usuario.usuario.perfil eq '2' or (usuario.usuario.perfil eq '4' and usuario.perfilAlterarCidadaoResponsavel)  and (solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Denúncia')}">
								<p:dataScroller value="#{mensagem.mensagensTramites}" var="msg"	chunkSize="2" rows="2" style="margin-bottom:1vw;">

									<f:facet name="loader">
										<p:commandLink id="outrasMsgs">
											<h:outputText value="Outras Mensagens" />
											<br />
											<i class="fa fa-caret-down" />
										</p:commandLink>
										<p:tooltip id="toolTipOutrasMsgs"
											value="Visualizar mensagens anteriores" for="outrasMsgs"
											position="top" style="box-shadow:none" />
									</f:facet>

									<p:outputPanel style="margin-top: 1vw;">
										<div class="mensagem">
											<h:outputText value="#{msg.usuario.nome}"
												style="color:#1a568c" />
											<h:outputText value="#{msg.data}" style="color:#1a568c">
												<f:convertDateTime pattern="d/M/yy - hh:mm"
													timeZone="GMT-03:00" />
											</h:outputText>
										</div>
										<h:outputText value="#{msg.texto}" style="margin-left:1vw" />

									</p:outputPanel>

								</p:dataScroller>
							</p:tab>
						</p:tabView>

						<h:form id="uploadForm" enctype="multipart/form-data" onsubmit="return Validate(this);">
							<p:outputPanel id="responderSolicitacao" rendered="#{usuario.usuario.perfil gt '1'}">
								<div id="Resposta" class="box aba" style="display: none; padding: 1vh 1vw">
									<p:outputLabel value="Mensagem de Resposta:" for="mensagem"	style="margin-bottom: 5px" />
									<p:inputTextarea id="mensagem" value="#{mensagem.mensagem.texto}" rows="10" autoResize="true" required="true"
										counter="respCount" maxlength="3000" counterTemplate="{0} caracteres restantes."
										style="width:99%" styleClass="abaField respostaField">
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="respCount" />
									
									<p:fileUpload id="fileUpload" value="#{mensagem.file}" label="Adicionar Anexo" mode="simple" skinSimple="true" style="margin-top: 1em"/>
										
									<p:commandLink class="botaoLink" action="#{mensagem.save}" ajax="false" style="margin-top: 5px"	update="form:solicitacao_panel ">
										<h:outputText value="Enviar" />
										<i class="fa fa-arrow-up" style="margin-left: 3px" />
										<f:setPropertyActionListener value="#{solicitacao.solicitacao}" target="#{mensagem.solicitacao}" />
									</p:commandLink>
								</div>
								
								<div id="Reformula" class="box aba" style="display: none; padding: 1vh 1vw">
									<p:outputLabel value="Pedido de reformulação:" for="reformula"	style="margin-bottom: 5px" />
									<p:inputTextarea id="reformula" value="#{mensagem.mensagem.texto}" rows="10" required="true" 
										counter="reforCount" maxlength="3000" counterTemplate="{0} caracteres restantes."
										style="width:99%" styleClass="abaField reformulaField">
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="reforCount" />
									
									<p:commandLink class="botaoLink" action="#{mensagem.save}" ajax="false" style="margin-top: 5px"	update="form:solicitacao_panel ">
										<h:outputText value="Enviar" />
										<i class="fa fa-arrow-up" style="margin-left: 3px" />
										<f:setPropertyActionListener value="#{solicitacao.solicitacao}" target="#{mensagem.solicitacao}" />
									</p:commandLink>
								</div>
								
								<div id="Negar" class="box aba" style="display: none; padding: 1vh 1vw">
									<p:outputLabel value="Justificativa:" for="justNega" style="margin-bottom: 5px" />
									<p:inputTextarea id="justNega" value="#{mensagem.mensagem.texto}" rows="10" required="true" 
										counter="negaCount" maxlength="3000" counterTemplate="{0} caracteres restantes."
										style="width:99%" styleClass="abaField negarField">
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="negaCount" />
									
									<p:commandLink class="botaoLink" action="#{mensagem.negar}" ajax="false" style="margin-top: 5px" update="form:solicitacao_panel">
										<h:outputText value="Enviar" />
										<i class="fa fa-arrow-up" style="margin-left: 3px" />
										<f:setPropertyActionListener value="#{solicitacao.solicitacao}" target="#{mensagem.solicitacao}" />
									</p:commandLink>
								</div>

								<div id="Prorrogar" class="box aba"
									style="display: none; padding: 1vh 1vw">
									<p:outputLabel value="Justificativa:" for="descr" />
									<p:inputTextarea id="descr" value="#{solicitacao.mensagem.texto}" styleClass="abaField prorrogarField" cols="100" rows="10" required="true" 
										counter="proCount" maxlength="3000" counterTemplate="{0} caracteres restantes." style="width: 98%" >
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="proCount" />

									<p:commandLink class="botaoLink" style="margin-top:1vh; justify-self: flex-end;" update="form:solicitacao_panel detalheDialog" action="#{solicitacao.prorrogar}" oncomplete="PF('detalheDialog').hide();">
										<h:outputText value="Salvar" />
										<f:setPropertyActionListener value="Prorrogada"	target="#{solicitacao.status}" />
										<i class="fa fa-check" style="padding-left: 3px" />
									</p:commandLink>
								</div>

								<div id="Recurso" class="box aba"
									style="display: none; padding: 1vh 1vw">
									<p:outputLabel value="Descrição:" for="descr2" />
									<p:inputTextarea id="descr2" value="#{solicitacao.mensagem.texto}" cols="100" rows="10" autoResize="false" 
										counter="recCount" maxlength="3000" counterTemplate="{0} caracteres restantes." 
										styleClass="abaField recursoField" style="width:100%" required="true" >
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="recCount" />

									<p:commandLink class="botaoLink" style="margin: 0 .7vw 1vh 0; justify-self: flex-end;" action="#{solicitacao.recurso}" update="@all" oncomplete="PF('detalheDialog').hide();">
										<h:outputText value="Salvar" />
										<f:setPropertyActionListener value="Recurso" target="#{mensagem.status}" />
										<i class="fa fa-check" style="padding-left: 3px" />
									</p:commandLink>
								</div>

								<div id="Encaminhar" class="box aba"
									style="display: none; padding: 1vh 1vw">
									<p:outputLabel value="Órgão/Entidade de destino" for="destino" />
									<p:selectOneMenu id="destino" value="#{solicitacao.idEntidades}" styleClass="abaField encaminharField">
<!-- 										<f:ajax value="#{solicitacao.popularEncaminharEntidade()}"  disabled="#{usuario.usuario.perfil eq '2' or usuario.usuario.perfil eq '5' or usuario.usuario.perfil eq '6'}"/> -->
										<f:selectItem itemLabel="Selecione Orgão Relacionado"
											noSelectionOption="true" />
										<f:selectItems value="#{entidades.todasEntidadesAtivas}" var="orgao" itemLabel="#{orgao.nome}" itemValue="#{orgao.idEntidades}" />
									</p:selectOneMenu>

									<p:outputLabel value="Justificativa Cidadão:" for="justCid" />
									<p:inputTextarea id="justCid" value="#{solicitacao.mensagem.texto}" cols="100" rows="10" autoResize="false" required="true"
										counter="justCount1" maxlength="3000" counterTemplate="{0} caracteres restantes."
										styleClass="abaField encaminharField" style="width:100%">
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="justCount1" />

									<p:outputLabel value="Justificativa Interna:" for="justInt" />
									<p:inputTextarea id="justInt" value="#{solicitacao.mensagemEncaminhar.texto}" cols="100" rows="10" autoResize="false" required="true"
										counter="justCount2" maxlength="3000" counterTemplate="{0} caracteres restantes."
										styleClass="abaField encaminharField" style="width:100%">
										<f:validateLength maximum="3000" />
									</p:inputTextarea>
									<h:outputText id="justCount2" />

									<p:commandLink class="botaoLink"
										style="margin: 0 .7vw 1vh 0; justify-self: flex-end;"
										action="#{solicitacao.encaminhar()}" update="@all"
										oncomplete="PF('detalheDialog').hide();">
										<h:outputText value="Salvar" />
										<i class="fa fa-check" style="padding-left: 3px" />
									</p:commandLink>
								</div>
								
								<div id="Avalia" class="box aba" style="display: none; padding: 1vh 1vw">
									<h:panelGroup styleClass="inline">
										<p:outputLabel value="Avaliar resposta da manifestação:" for="avalia" style="margin-bottom: 20px; margin-right: .5em" />
										<p:rating id="avalia" cancel="false" value="#{mensagem.nota}" required="true" styleClass="abaField avaliaField"/>
									</h:panelGroup>
									
									<p:outputLabel value="Mensagem:" for="avaliaTexto" style="margin-top: 0"/>
									<p:inputTextarea id="avaliaTexto" value="#{mensagem.mensagem.texto}" cols="100" rows="8" autoResize="true" required="false" 
										counter="avaCount" maxlength="1000" counterTemplate="{0} caracteres restantes." 
										styleClass="abaField avaliaField" style="width:100%">
										<f:validateLength maximum="1000" />
									</p:inputTextarea>
									<h:outputText id="avaCount"/>
									
									<p:commandLink class="botaoLink" ajax="false" style="margin-top: 5px" action="#{mensagem.salvarMensagemAvaliacao()}" update="form:solicitacao_panel ">
										<f:setPropertyActionListener value="#{solicitacao.solicitacao}" target="#{avaliacao.solicitacao}" />
										<f:setPropertyActionListener value="#{solicitacao.solicitacao}" target="#{mensagem.solicitacao}" />
										<h:outputText value="Enviar" />
										<i class="fa fa-arrow-up" style="margin-left: 3px" />
									</p:commandLink>
								</div>
							</p:outputPanel>
						</h:form>

					</h:panelGroup>

					<!-- 				Barra de ações -->
					<h:panelGroup id="barraBtns">

						<!-- Botão Resposta -->
						<p:commandLink id="RespostaAba"
							onclick="abrirAba('Resposta');selecionarAba('RespostaAba');desativarCampos('respostaField')"
							rendered="#{(usuario.usuario.perfil eq '2' or (usuario.usuario.perfil eq '4' and usuario.perfilAlterarCidadaoResponsavel) )}"
							disabled="#{solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.status eq 'Sem Resposta' or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Negada'}"
							styleClass="blankSquareBtn">
							<i class="fa fa-comments fa-3x" style="margin-bottom: 5px" />
							<h:outputText value="Responder" />
<!-- 							disabled="#{solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Negada'}" -->
						</p:commandLink>
						
						<!-- Botão Reformula -->
						<p:commandLink id="ReformulaAba"
							onclick="abrirAba('Reformula');selecionarAba('ReformulaAba');desativarCampos('reformulaField')"
							rendered="#{(usuario.usuario.perfil eq '2' or (usuario.usuario.perfil eq '4' and usuario.perfilAlterarCidadaoResponsavel) ) and solicitacao.solicitacao.tipo ne 'Denúncia'}"
							disabled="#{solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.status eq 'Sem Resposta' or solicitacao.solicitacao.tipo eq 'Denúncia' or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Negada'}"
							styleClass="blankSquareBtn">
							<span class="fa-stack fa-lg">
							  <i class="fa fa-comment fa-stack-2x" />
							  <i class="fa fa-repeat fa-stack-1x fa-inverse" />
							</span>
							<h:outputText value="Solicitar Reformulação" />
						</p:commandLink>
						
						<!-- Botão Negar -->
						<p:commandLink id="NegarAba"
							onclick="abrirAba('Negar');selecionarAba('NegarAba');desativarCampos('negarField')"
							rendered="#{(usuario.usuario.perfil eq '2' or (usuario.usuario.perfil eq '4' and usuario.perfilAlterarCidadaoResponsavel) ) and solicitacao.solicitacao.tipo ne 'Denúncia'}"
							disabled="#{solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.status eq 'Sem Resposta' or solicitacao.solicitacao.tipo eq 'Denúncia' or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Negada'}"
							styleClass="blankSquareBtn">
							<i class="fa fa-ban fa-3x" style="margin-bottom: 5px" />
							<h:outputText value="Negar" />
						</p:commandLink>

						<!-- Botão Encaminhar -->
						<p:commandLink id="EncaminharAba" class="botaoAba"
							onclick="abrirAba('Encaminhar');selecionarAba('EncaminharAba');desativarCampos('encaminharField')"
							rendered="#{(usuario.usuario.perfil eq '2' or (usuario.usuario.perfil eq '4' and usuario.perfilAlterarCidadaoResponsavel) ) }"
							disabled="#{solicitacao.ehEncaminhavel() eq false or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Prorrogada' or solicitacao.solicitacao.status eq 'Negada'}"
							styleClass="blankSquareBtn">
							<i class="fa fa-hand-o-up fa-3x" style="margin-bottom: 5px" />
							<h:outputText value="Encaminhar" />
							<f:setPropertyActionListener value="#{solicitacao.solicitacao}"
								target="#{entidades.solicitacao}" />
						</p:commandLink>

						<!-- Botão Prorrogar -->
						<p:commandLink id="ProrrogarAba" class="botaoAba"
							onclick="abrirAba('Prorrogar');selecionarAba('ProrrogarAba');desativarCampos('prorrogarField')"
							styleClass="blankSquareBtn"
							rendered="#{(usuario.usuario.perfil eq '2' or (usuario.usuario.perfil eq '4' and usuario.perfilAlterarCidadaoResponsavel) ) and solicitacao.solicitacao.tipo ne 'Denúncia'}"
							disabled="#{solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.status eq 'Sem Resposta' or solicitacao.solicitacao.tipo eq 'Denúncia' or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Negada' or solicitacao.solicitacao.status eq 'Prorrogada'}">
<!-- 						 or ((solicitacao.solicitacao.tipo eq 'Solicitação' or solicitacao.solicitacao.tipo eq 'Informação') and solicitacao.ehProrrogavel() eq false)}"> -->
							<i class="fa fa-clock-o fa-3x" style="margin-bottom: 5px" />
							<h:outputText value="Prorrogar Resposta" />
							<f:setPropertyActionListener value="#{solicitacao.solicitacao}"
								target="#{solicitacao.solicitacao}" />
						</p:commandLink>
						
						<!-- Botão Avalia -->
						<p:commandLink id="AvaliaAba"
							onclick="abrirAba('Avalia');selecionarAba('AvaliaAba');desativarCampos('avaliaField')"
							rendered="#{(usuario.usuario.perfil eq '3' or (usuario.usuario.perfil eq '4' and !usuario.perfilAlterarCidadaoResponsavel)) and (solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.status eq 'Atendida' or solicitacao.solicitacao.status eq 'Sem Resposta') and (solicitacao.solicitacao.tipo ne 'Informação' or solicitacao.solicitacao.tipo ne 'Solicitação')}"
							disabled="#{solicitacao.solicitacao.status eq 'Aberta' or solicitacao.solicitacao.avaliacao ne '0'}"
							styleClass="blankSquareBtn">
							<i class="fa fa-star-half-o fa-3x" />
							<h:outputText value="Avaliar resposta" />
						</p:commandLink>

						<!-- Botão Recurso -->
						<p:commandLink id="RecursoAba"
							onclick="abrirAba('Recurso');selecionarAba('RecursoAba');desativarCampos('recursoField')"
							rendered="#{usuario.usuario.perfil eq '3' or (usuario.usuario.perfil eq '4' and !usuario.perfilAlterarCidadaoResponsavel) and (solicitacao.solicitacao.tipo eq 'Informação' or solicitacao.solicitacao.tipo eq 'Solicitação')}"
							disabled="#{solicitacao.recursoLiberado() eq false or solicitacao.solicitacao.status eq 'Finalizada' or solicitacao.solicitacao.datafim ne null}"
							update="form:solicitacao_panel" styleClass="blankSquareBtn">
							<i class="fa fa-hand-o-up fa-3x" style="margin-bottom: 5px" />
							<h:outputText value="Realizar Recurso" />
							<f:setPropertyActionListener value="Recurso"
								target="#{solicitacao.status}" />
							<f:setPropertyActionListener value="#{solicitacao.solicitacao}"
								target="#{solicitacao.solicitacao}" />
						</p:commandLink>

					</h:panelGroup>
				</p:outputPanel>
			</p:dialog>
			
			<!-- JAVASCRIPT -->
			<script>
				function abrirAba(aba) {
					var x = document.getElementsByClassName("aba");
					for (var i = 0; x.length > i; i++) {
						x[i].style.display = "none";
					}
					document.getElementById(aba).style.display = "flex";
				}

				function selecionarAba(abaBtn) {
					var x = document.getElementsByClassName("blankSquareBtn");
					for (var i = 0; x.length > i; i++) {
						x[i].style.background = "#e4e4e4";
						x[i].style.outline = "none";
						x[i].style.border = "1px solid #e4e4e4";
					}

					document.getElementById(abaBtn).style.outline = "1px solid white";
					document.getElementById(abaBtn).style.background = "white";
					document.getElementById(abaBtn).style.border = "none";
				}

				function desativarCampos(abaField) {
					var x = document.getElementsByClassName("abaField");
					for (var i = 0; x.length > i; i++) {
						x[i].disabled = true;
					}

					var y = document.getElementsByClassName(abaField);
					for (var i = 0; y.length > i; i++) {
						y[i].disabled = false;
					}
				}

				function scrollDown() {
					document.getElementById("solicitacaoDetalhe").style.bottom = "0";
					}

				function Validate(oForm) {
					var _validFileExtensions = [".jpg", ".jpeg", ".bmp", ".gif", ".png", ".docx", ".pdf", ".xlsx", ".ods", ".mp3", ".wav", ".AAC", ".FLAC", ".ALAC", ".ALE", ".FLV", ".mp4", ".avi", ".WMV", ".MOV", ".zip", ".rar", ".7z"];    
					var arrInputs = oForm.getElementsByTagName("input");
					var oFile = document.getElementById("uploadForm:fileUpload_input").files[0];

				    for (var i = 0; i &lt; arrInputs.length; i++) {
				        var oInput = arrInputs[i];
				        if (oInput.type == "file") {
				            var sFileName = oInput.value;
				            if (sFileName.length > 0) {
				                var blnValid = false;
								if (oFile.size &lt; 16 * (1024 * 1024)) {

					                for (var j = 0; j &lt; _validFileExtensions.length; j++) {
					                    var sCurExtension = _validFileExtensions[j];
					                    if (sFileName.substr(sFileName.length - sCurExtension.length, sCurExtension.length).toLowerCase() == sCurExtension.toLowerCase()) {
					                        blnValid = true;
					                        break;
					                    }
					                }
									
					                if (!blnValid) {
					                    alert("Formato inválido. São aceitos apenas: " + _validFileExtensions.join(", "));
					                    return false;
					                }
					                
								} 
								else {
									alert("Tamanho do arquivo excedeu o limite de 16 MB aceitos");
				                    return false;
								}
				                
				            }
				        }
				    }
				}
			</script>


		</ui:define>

	</ui:composition>

</h:body>

</html>